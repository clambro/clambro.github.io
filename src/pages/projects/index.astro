---
import Base from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import ProjectPreview from '../../components/ProjectPreview.astro';

// Get all projects and sort by date (newest first)
const projects = await getCollection('projects');
const sortedProjects = projects.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

// Filter into featured and other projects
const featuredProjects = sortedProjects.filter((p) => p.data.is_featured);
const otherProjects = sortedProjects.filter((p) => !p.data.is_featured);
---

<Base title="Projects">
  <h1>Projects</h1>
  <p class="muted">
    A collection of my work in ML, backend engineering, and AI.
  </p>

  {
    featuredProjects.length > 0 && (
      <section class="project-section">
        <h2>Featured Projects</h2>
        <div class="projects">
          {featuredProjects.map((project) => (
            <ProjectPreview project={project} />
          ))}
        </div>
      </section>
    )
  }

  {
    otherProjects.length > 0 && (
      <section class="project-section">
        <h2>Other Projects</h2>
        <div class="projects">
          {otherProjects.map((project) => (
            <ProjectPreview project={project} />
          ))}
        </div>
      </section>
    )
  }
</Base>

<style>
  .project-section {
    margin-top: 4rem;
  }

  .project-section h2 {
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
  }

  .projects {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .projects {
      grid-template-columns: repeat(2, 350px);
    }
  }
</style>
