---
import '../styles/global.css';
import { siteConfig } from '../config';

interface Props {
  title?: string;
  description?: string;
  type?: 'website' | 'article';
}

const {
  title = siteConfig.title,
  description = siteConfig.description,
  type = 'website',
} = Astro.props;

const pageTitle =
  title === siteConfig.title ? title : `${title} | ${siteConfig.title}`;
const canonicalUrl = new URL(Astro.url.pathname, siteConfig.siteUrl).href;
const ogImage = new URL(siteConfig.ogImage, siteConfig.siteUrl).href;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={description} />
    <link rel="icon" href="/icons/favicon.svg" />
    <link rel="canonical" href={canonicalUrl} />

    <!-- Open Graph -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:alt" content={siteConfig.title} />
    <meta property="og:site_name" content={siteConfig.title} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content={siteConfig.social.twitterHandle} />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <meta name="twitter:image:alt" content={siteConfig.title} />

    <!-- RSS Feed Discovery -->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Costa Lambrinoudis - RSS Feed"
      href="/feed.xml"
    />
  </head>
  <body>
    <header class="site-header">
      <div>
        <a class="brand" href="/">Costa Lambrinoudis</a>
        <nav class="nav">
          <a href="/projects">Projects</a>
          <a href="/blog">Blog</a>
        </nav>
        <nav class="social">
          <a
            href={siteConfig.social.github}
            target="_blank"
            rel="noopener"
            aria-label="GitHub"
            class="social-link"
          >
            <svg viewBox="0 0 24 24">
              <use href="/icons/github.svg#github"></use>
            </svg>
          </a>
          <a
            href={siteConfig.social.linkedin}
            target="_blank"
            rel="noopener"
            aria-label="LinkedIn"
            class="social-link"
          >
            <svg viewBox="0 0 24 24">
              <use href="/icons/linkedin.svg#linkedin"></use>
            </svg>
          </a>
          <a
            href={siteConfig.social.twitter}
            target="_blank"
            rel="noopener"
            aria-label="X (Twitter)"
            class="social-link"
          >
            <svg viewBox="0 0 24 24">
              <use href="/icons/x.svg#x"></use>
            </svg>
          </a>
          <a
            href={siteConfig.social.rss}
            aria-label="RSS Feed"
            class="social-link"
            title="RSS feed"
          >
            <svg viewBox="0 0 24 24">
              <use href="/icons/rss.svg#rss"></use>
            </svg>
          </a>
        </nav>
      </div>
    </header>

    <main class="container">
      <slot />
    </main>

    <footer class="site-footer">
      <div>
        <small>Â© {new Date().getFullYear()} Costa Lambrinoudis</small>
      </div>
    </footer>

    <script>
      let lastScrollY = window.scrollY;
      let ticking = false;

      const header = document.querySelector('.site-header');

      function updateHeader() {
        const currentScrollY = window.scrollY;

        if (currentScrollY < 10) {
          // Near the top, always show header
          header?.classList.remove('hide');
        } else if (currentScrollY > lastScrollY) {
          // Scrolling down
          header?.classList.add('hide');
        } else {
          // Scrolling up
          header?.classList.remove('hide');
        }

        lastScrollY = currentScrollY;
        ticking = false;
      }

      function onScroll() {
        if (!ticking) {
          requestAnimationFrame(updateHeader);
          ticking = true;
        }
      }

      window.addEventListener('scroll', onScroll);
    </script>
  </body>
</html>
